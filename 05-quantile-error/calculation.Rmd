---
title: "calculation"
output: html_document
---

```{r}
library(ggplot2)
```


# Q1

For each distribution below, generate the following figure. The sampling distribution for the quantiles is generated by repeatedly calculating the quantiles from random samples of size N. In this assignment let N = 200. Calculate the length of the middle 95% of the sampling distribution by calculating the difference between 2.5% and 97.5% percentiles of the sampling distribution. Your empirical sampling distribution should be at least 5000 draws.

## test
```{r}
N = 1000      # sample size

# generate a random sample of size N
s <- runif(N, 0,1)

# plot a histogram to check data
ggplot(data.frame(s), aes(x = s)) +
  geom_histogram(binwidth = 0.02)

# calculate the quantiles
dis <- quantile(s, probs = seq(0.05, 0.95, 0.05))
dis
```

## Dis 1
```{r}
# for Distribution 1: normal distribution
N_simulation <- 5000   # Simulation size N
N = 200      # sample size
col = 19      # number of columns in the matrix
qtl_matrix <- matrix(ncol = col)         # matrix to store quantiles of size N_sim * col

set.seed(5)
for(i in 1:N_simulation){
  # generate a random sample of size N
  s <- rnorm(N, mean = 0, sd = 1)
  dis <- quantile(s, probs = seq(0.05, 0.95, 0.05))
  qtl_matrix <- rbind(qtl_matrix, dis)
}

# calculate the length of the middle 95%
qtl_length <- rep(NA, col)

for(i in seq(qtl_length)){
  q <- quantile(qtl_matrix[,i], probs = c(0.025, 0.975), na.rm = TRUE)
  qtl_length[i] <- q[[2]] - q[[1]]
  }


```

```{r}
# plot
ggplot(data.frame(qtl_length), aes(x = seq(0.05, 0.95, 0.05), y = qtl_length)) +
  geom_point()+
  geom_line()
```


# Q2

For each distribution below, generate the following figure. The x-axis is a transformation of the x-values in the previous figure. You will calculate the density (relative likelihood) corresponding to the pt**h quantiles from the previous figure.

##test
```{r}
x <- c(1,3,5)
y <- c(1,2,3)
m <- data.frame(cbind(x,y))

ggplot(m, aes(x))+
  geom_histogram(aes(y = ..density..))

approx(density(x), xout = x)
```

## Distribution 1
```{r}
qtl <- seq(0.05, 0.95, 0.05)
x <- qnorm(qtl, mean = 0, sd = 1)
dens_x <- dnorm(x, mean = 0, sd = 1)
```

```{r}
dens_matrix <- data.frame(cbind(dens_x, qtl_length))

ggplot(dens_matrix, aes(dens_x, qtl_length))+
  geom_point()+
  geom_li
```


# Distribution
Distribution 1
Use the standard normal distribution.

## P1
```{r}
# for Distribution 1: normal distribution
N_simulation <- 5000   # Simulation size N
N = 200      # sample size
col = 19      # number of columns in the matrix
qtl_matrix <- matrix(ncol = col)         # matrix to store quantiles of size N_sim * col

set.seed(5)
for(i in 1:N_simulation){
  # generate a random sample of size N
  s <- rnorm(N, mean = 0, sd = 1)
  dis <- quantile(s, probs = seq(0.05, 0.95, 0.05))
  qtl_matrix <- rbind(qtl_matrix, dis)
}

# calculate the length of the middle 95%
qtl_length <- rep(NA, col)

for(i in seq(qtl_length)){
  q <- quantile(qtl_matrix[,i], probs = c(0.025, 0.975), na.rm = TRUE)
  qtl_length[i] <- q[[2]] - q[[1]]
  }
```

```{r}
# plot
ggplot(data.frame(qtl_length), aes(x = seq(0.05, 0.95, 0.05), y = qtl_length)) +
  geom_point()+
  geom_line()
```


## P2
```{r}
qtl <- seq(0.05, 0.95, 0.05)
x <- qnorm(qtl, mean = 0, sd = 1)
dens_x <- dnorm(x, mean = 0, sd = 1)
```

```{r}
dens_matrix <- data.frame(cbind(dens_x, qtl_length))

ggplot(dens_matrix, aes(dens_x, qtl_length))+
  geom_point()+
  geom_line()
```

## Distribution 2
Use the exponential distribution with rate = 1.

```{r}
s <- rexp(200, rate = 1)
hist(s, breaks = 30)
```


## P1
```{r}
# for Distribution 2: exponential distribution
N_simulation <- 5000   # Simulation size N
N = 200      # sample size
col = 19      # number of columns in the matrix
d2_qtl_matrix <- matrix(ncol = col)         # matrix to store quantiles of size N_sim * col

for(i in 1:N_simulation){
  # generate a random sample of size N
  s <- rexp(N, rate = 1)
  dis <- quantile(s, probs = seq(0.05, 0.95, 0.05))
  d2_qtl_matrix <- rbind(d2_qtl_matrix, dis)
}

# calculate the length of the middle 95%
d2_qtl_length <- rep(NA, col)

for(i in seq(qtl_length)){
  q <- quantile(d2_qtl_matrix[,i], probs = c(0.025, 0.975), na.rm = TRUE)
  d2_qtl_length[i] <- q[[2]] - q[[1]]
  }
```

```{r}
# plot
ggplot(data.frame(d2_qtl_length), aes(x = seq(0.05, 0.95, 0.05), y = d2_qtl_length)) +
  geom_point()+
  geom_line()
```

## P2
```{r}
qtl <- seq(0.05, 0.95, 0.05)
x <- qexp(qtl, rate = 1)
d2_dens_x <- dexp(x, rate = 1)
```

```{r}
d2_dens_matrix <- data.frame(cbind(d2_dens_x, d2_qtl_length))

ggplot(d2_dens_matrix, aes(d2_dens_x, d2_qtl_length))+
  geom_point()+
  geom_line()+
  scale_x_continuous(breaks = waiver(), labels = waiver())+
  labs(title = "Length of middle 95% by density", x = "Density", y = "Length")+
  theme_classic()
```


#Distribution 3
Use the following mixture distribution.
```{r}
rf3 <- function(N){
  G <- sample(0:2, N, replace = TRUE, prob = c(5,3,2))
  (G==0)*rnorm(N) + (G==1)*rnorm(N,4) + (G==2)*rnorm(N,-4,2)
}

pf3 <- function(x){
  .5*pnorm(x) + .3*pnorm(x,4) + .2*pnorm(x,-4,2)
}

df3 <- function(x){
  .5*dnorm(x) + .3*dnorm(x,4) + .2*dnorm(x,-4,2)
}
```


```{r}
hist(rf3(N), breaks = 50)
```

## P1
```{r}
# for Distribution 2: exponential distribution
N_simulation <- 5000   # Simulation size N
N = 200      # sample size
col = 19      # number of columns in the matrix
d3_qtl_matrix <- matrix(ncol = col)         # matrix to store quantiles of size N_sim * col

for(i in 1:N_simulation){
  # generate a random sample of size N
  s <- rf3(N)
  dis <- quantile(s, probs = seq(0.05, 0.95, 0.05))
  d3_qtl_matrix <- rbind(d3_qtl_matrix, dis)
}

# calculate the length of the middle 95%
d3_qtl_length <- rep(NA, col)

for(i in seq(qtl_length)){
  q <- quantile(d3_qtl_matrix[,i], probs = c(0.025, 0.975), na.rm = TRUE)
  d3_qtl_length[i] <- q[[2]] - q[[1]]
  }
```

```{r}
# plot
ggplot(data.frame(d3_qtl_length), aes(x = seq(0.05, 0.95, 0.05), y = d3_qtl_length)) +
  geom_point()+
  geom_line()+
  scale_x_continuous(limits = c(0.05,0.95), breaks = qtl, labels = qtl)+
  labs(title = "Length of middle 95% of sampling distance", x = "p quantile", y = "Length")+
  theme_classic()
```

## P2
```{r}
qtl <- seq(0.05, 0.95, 0.05)
d3_dens_x <- rep(NA, col)

qf3 <- function(y){
    uniroot(function(x) pf3(x) - y, interval = c(-100, 100))$root 
}

for(i in 1:col){
  x <- qtl[i]
  mx <- qf3(x)
  d3_dens_x[i] <- df3(mx)
}
```

```{r}
d3_dens_matrix <- data.frame(cbind(d3_dens_x, d3_qtl_length))

ggplot(d3_dens_matrix, aes(d3_dens_x, d3_qtl_length))+
  geom_point()+
  geom_line()+
  scale_x_continuous(breaks = waiver(), labels = waiver())+
  labs(title = "Length of middle 95% by density", x = "Density", y = "Length")+
  theme_classic()
```
Distribution 4
Use the following mixture distribution.

```{r}
rf4 <- function(N){
  G <- sample(0:1, N, replace = TRUE)
  (G==0)*rbeta(N,5,1) + (G==1)*rbeta(N,1,5)
}

pf4 <- function(x){
  0.5*pbeta(N,5,1) + 0.5*pbeta(N,1,5)
}

df4 <- function(x){
  0.5*dbeta(N,5,1) + 0.5*dbeta(N,1,5)
}
```

```{r}
hist(rf3(N), breaks = 50)
```

## P1
```{r}
# for Distribution 2: exponential distribution
N_simulation <- 5000   # Simulation size N
N = 200      # sample size
col = 19      # number of columns in the matrix
d4_qtl_matrix <- matrix(ncol = col)         # matrix to store quantiles of size N_sim * col

for(i in 1:N_simulation){
  # generate a random sample of size N
  s <- rf4(N)
  dis <- quantile(s, probs = seq(0.05, 0.95, 0.05))
  d4_qtl_matrix <- rbind(d4_qtl_matrix, dis)
}

# calculate the length of the middle 95%
d4_qtl_length <- rep(NA, col)

for(i in seq(qtl_length)){
  q <- quantile(d4_qtl_matrix[,i], probs = c(0.025, 0.975), na.rm = TRUE)
  d4_qtl_length[i] <- q[[2]] - q[[1]]
  }
```

```{r}
# plot
ggplot(data.frame(d4_qtl_length), aes(x = seq(0.05, 0.95, 0.05), y = d4_qtl_length)) +
  geom_point()+
  geom_line()+
  scale_x_continuous(limits = c(0.05,0.95), breaks = qtl, labels = qtl)+
  labs(title = "Length of middle 95% of sampling distance", x = "p quantile", y = "Length")+
  theme_classic()
```

## P2
```{r}
qtl <- seq(0.05, 0.95, 0.05)
d4_dens_x <- rep(NA, col)

qf4 <- function(y){
  uniroot(function(x) pf3(x) - y, interval = c(-Inf, Inf))$root 
}

for(i in 1:col){
  x <- qtl[i]
  mx <- qf4(x)
  d4_dens_x[i] <- df4(mx)
}
```

```{r}
d4_dens_matrix <- data.frame(cbind(d4_dens_x, d4_qtl_length))

ggplot(d4_dens_matrix, aes(d4_dens_x, d4_qtl_length))+
  geom_point()+
  geom_line()+
  scale_x_continuous(breaks = waiver(), labels = waiver())+
  labs(title = "Length of middle 95% by density", x = "Density", y = "Length")+
  theme_classic()
```